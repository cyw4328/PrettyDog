<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<!-- namespace : 이 XML 이 어떤 interface 와 연결되는지 설정 -->
	<!-- 리스트 출력 -->
<mapper namespace="com.pretty.dog.dao.CommunityDAO">

	<!--  
	<select id="freeList" resultType="dog">
		select community_boardnum, category_num, community_sub,mem_id,community_date, community_view, community_likes, community_blind
		from community_board order by community_boardnum desc
	</select>
	-->
	
	
	<select id="categoryList" resultType="com.pretty.dog.dto.CommunityDTO">
		select category_num, category_name,category_admin,category_blind  
		from community_category	
	</select>
	
	
	<select id="listCall" resultType="com.pretty.dog.dto.CommunityDTO">
     	select cb.community_boardnum, cb.category_num, cb.community_sub, cb.mem_id , cb.community_date, cb.community_view, cb.community_likes, cb.community_blind,
		cc.category_num,cc.category_name,cc.category_admin,cc.category_blind
		from  community_board cb, community_category cc 
		where cb.category_num = cc.category_num 
		<if test="param3 != 9">
			and cb.category_num = #{param3}
		</if>
		order by community_boardnum desc
 		limit #{param1} offset #{param2}

   </select>  
	
   
   <select id="allCount" resultType="int" parameterType="Integer">
   		select count(community_boardnum)
   		from community_board 
   		where category_num not in(3)
   </select>
		
	
	<!-- 게시판내 검색 -->
	<!--  
	 <select id="freeSearch" parameterType="hashMap" resultType="com.pretty.dog.dto.CommunityDTO">
		 	select cb.community_boardnum, cb.category_num, cb.community_sub, cb.mem_id , cb.community_date, cb.community_view, cb.community_likes, cb.community_blind,
			cc.category_num,cc.category_name,cc.category_admin,cc.category_blind
			from  community_board cb, community_category cc 
	 	<where>
		 	<if test="opt.equals('community_sub') and !keyword.equals('')">
		 		 cb.community_sub LIKE CONCAT('%',#{keyword},'%')
		 	</if>
			<if test="opt.equals('community_cont') and !keyword.equals('')">
		 		cb.community_cont LIKE CONCAT('%',#{keyword},'%')
		 	</if>
		 	<if test="opt.equals('mem_id') and !keyword.equals('')">
		 		cb.mem_id LIKE CONCAT('%',#{keyword},'%')
		 	</if>
	 	</where>
	 	
		and cb.category_num = cc.category_num
	 </select>	
	-->
	  
	<insert id="freeWrite" 
   useGeneratedKeys="true" 
   keyProperty="idx"
   keyColumn="idx"
   parameterType="com.pretty.dog.dto.CommunityDTO">
   		INSERT INTO community_board(community_sub,community_cont,mem_id,category_num)VALUES(#{community_sub},#{community_cont},#{mem_id},#{category_num})  
   </insert >
   
   
   <insert id="fileWrite" >
   		INSERT INTO community_board_photo(community_boardnum,bphoto_oriname,bphoto_newname)VALUES(#{param1},#{param2},#{param3}) 
   		
   </insert>
	
	
	
	<select id="detail" resultType="com.pretty.dog.dto.CommunityDTO">
   		SELECT * FROM community_board WHERE community_boardnum =#{param1}
   </select>
	
	<update id="community_view">
   		UPDATE community_board SET community_view = community_view+1 WHERE community_boardnum = #{param1}
   </update>
   
   <select id="photoList" resultType="com.pretty.dog.dto.CommunityDTO">
      select bphoto_oriname, bphoto_newname from community_board_photo where community_boardnum = #{param1}
   </select>
	
	<!--
	insert into community_board(category_num,mem_id,community_sub,community_cont) 
	values(2,'aaa','테스트 자유게시판','테스트 자유게시판 테스트 자유게시판 테스트 자유게시판 테스트 자유게시판');


	insert into community_board_photo(community_boardnum,bphoto_oriname,bphoto_newname) 
	values(2,'백신펫스','787878787');
	
	-->
	
	<delete id="freeDelete">
      delete from community_board where community_boardnum = #{param1}
   </delete>
   
   
   
   <update id="freeUpdate" parameterType="HashMap">
      update community_board set community_sub = #{community_sub}
      ,community_cont = #{community_cont}
      ,category_num = #{category_num}
      where community_boardnum = #{community_boardnum}
   </update>
  
  
   
   
	
	
	
	
	
</mapper>